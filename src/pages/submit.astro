---
import BaseLayout from '../layouts/BaseLayout.astro';
import siteConfig from '../data/site-config.json';
import states from '../data/states.json';
---

<BaseLayout
  title="Add Your Porta Potty Business"
  description={`Get your portable restroom rental business listed on ${siteConfig.name} for free and reach thousands of potential customers.`}
>
  <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <h1 class="text-4xl font-bold text-gray-900 mb-4">Add Your Business</h1>
    <p class="text-xl text-gray-600 mb-8">
      Get your porta potty rental business listed on {siteConfig.name} and reach thousands of potential customers - for free!
    </p>

    <div class="bg-white rounded-xl shadow-md p-6 md:p-8">
      <form id="submit-form" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="md:col-span-2">
            <label for="business_name" class="block text-sm font-medium text-gray-700 mb-1">
              Business Name *
            </label>
            <input
              type="text"
              id="business_name"
              name="business_name"
              required
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
            />
          </div>

          <div>
            <label for="contact_name" class="block text-sm font-medium text-gray-700 mb-1">
              Contact Name
            </label>
            <input
              type="text"
              id="contact_name"
              name="contact_name"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
            />
          </div>

          <div>
            <label for="contact_email" class="block text-sm font-medium text-gray-700 mb-1">
              Email Address *
            </label>
            <input
              type="email"
              id="contact_email"
              name="contact_email"
              required
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
            />
          </div>

          <div>
            <label for="city" class="block text-sm font-medium text-gray-700 mb-1">
              City *
            </label>
            <input
              type="text"
              id="city"
              name="city"
              required
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
            />
          </div>

          <div>
            <label for="state" class="block text-sm font-medium text-gray-700 mb-1">
              State *
            </label>
            <select
              id="state"
              name="state"
              required
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
            >
              <option value="">Select a state</option>
              {states.map((state) => (
                <option value={state.name}>{state.name}</option>
              ))}
            </select>
          </div>

          <div>
            <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">
              Phone Number *
            </label>
            <input
              type="tel"
              id="phone"
              name="phone"
              required
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
            />
          </div>

          <div>
            <label for="website" class="block text-sm font-medium text-gray-700 mb-1">
              Website
            </label>
            <input
              type="url"
              id="website"
              name="website"
              placeholder="https://"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
            />
          </div>

          <div class="md:col-span-2">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Services Offered *
            </label>
            <div class="grid grid-cols-2 gap-3">
              {['Standard Units', 'Handicap Accessible', 'Luxury Trailers', 'VIP Units', 'Shower Units', 'Sink Stations', 'Hand Wash Stations', 'Holding Tanks'].map((service) => (
                <label class="flex items-center">
                  <input
                    type="checkbox"
                    name="services"
                    value={service}
                    class="rounded border-gray-300 text-primary-600 focus:ring-primary-500 mr-2"
                  />
                  <span class="text-sm text-gray-700">{service}</span>
                </label>
              ))}
            </div>
          </div>

          <div class="md:col-span-2">
            <label for="description" class="block text-sm font-medium text-gray-700 mb-1">
              Business Description
            </label>
            <textarea
              id="description"
              name="description"
              rows="4"
              placeholder="Tell us about your business, service area, and what makes you stand out..."
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
            ></textarea>
          </div>
        </div>

        <div class="border-t pt-6">
          <button
            type="submit"
            class="w-full bg-primary-600 text-white py-3 px-6 rounded-lg font-medium hover:bg-primary-700 transition-colors"
          >
            Submit Listing
          </button>
        </div>

        <div id="form-message" class="hidden text-center py-3 rounded-lg"></div>

        <p class="text-sm text-gray-500 text-center">
          Submissions are reviewed before being published. We'll notify you via email once approved.
        </p>
      </form>
    </div>
  </div>
</BaseLayout>

<script>
  const form = document.getElementById('submit-form') as HTMLFormElement;
  const messageDiv = document.getElementById('form-message') as HTMLDivElement;
  const submitBtn = form?.querySelector('button[type="submit"]') as HTMLButtonElement;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const services = formData.getAll('services');

    if (services.length === 0) {
      messageDiv.textContent = 'Please select at least one service.';
      messageDiv.className = 'text-center py-3 rounded-lg bg-red-100 text-red-700';
      messageDiv.classList.remove('hidden');
      return;
    }

    // Disable button while submitting
    submitBtn.disabled = true;
    submitBtn.textContent = 'Submitting...';

    // Build email body
    const data = {
      access_key: 'b5f97214-832b-4657-93dc-72b24f45f64c',
      subject: `New Listing Submission: ${formData.get('business_name')}`,
      from_name: 'Potty Directory',
      to: 'info@pottydirectory.com',
      business_name: formData.get('business_name'),
      contact_name: formData.get('contact_name') || 'Not provided',
      contact_email: formData.get('contact_email'),
      city: formData.get('city'),
      state: formData.get('state'),
      phone: formData.get('phone'),
      website: formData.get('website') || 'Not provided',
      services: services.join(', '),
      description: formData.get('description') || 'Not provided'
    };

    try {
      const response = await fetch('https://api.web3forms.com/submit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      const result = await response.json();

      if (result.success) {
        messageDiv.textContent = 'Thank you! Your submission has been received. We\'ll review it and reach out soon.';
        messageDiv.className = 'text-center py-3 rounded-lg bg-green-100 text-green-700';
        form.reset();
      } else {
        throw new Error('Submission failed');
      }
    } catch (error) {
      messageDiv.textContent = 'Something went wrong. Please email us directly at info@pottydirectory.com';
      messageDiv.className = 'text-center py-3 rounded-lg bg-red-100 text-red-700';
    }

    messageDiv.classList.remove('hidden');
    submitBtn.disabled = false;
    submitBtn.textContent = 'Submit Listing';
  });
</script>
