---
import BaseLayout from '../layouts/BaseLayout.astro';
import Breadcrumb from '../components/Breadcrumb.astro';

const breadcrumbs = [
  { label: 'Home', href: '/' },
  { label: 'Calculator' }
];
---

<BaseLayout
  title="Porta Potty Calculator | How Many Portable Toilets Do I Need?"
  description="Free porta potty calculator for events and construction sites. Calculate exactly how many portable toilets you need based on guests, duration, and event type."
>
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <Breadcrumb items={breadcrumbs} />

    <div class="text-center mb-10">
      <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
        Porta Potty Calculator
      </h1>
      <p class="text-xl text-gray-600 max-w-2xl mx-auto">
        Calculate how many portable toilets you need for your event or job site. Get accurate estimates based on industry standards.
      </p>
    </div>

    <!-- Calculator Card -->
    <div class="bg-white rounded-2xl shadow-xl p-6 md:p-8 mb-8">
      <form id="calculator-form" class="space-y-6">
        <!-- Event Type -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">
            What type of event or site?
          </label>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
            <label class="relative">
              <input type="radio" name="event_type" value="event" class="peer sr-only" checked />
              <div class="p-4 border-2 border-gray-200 rounded-xl text-center cursor-pointer peer-checked:border-primary-500 peer-checked:bg-primary-50 hover:border-gray-300 transition-colors">
                <div class="text-2xl mb-1">üéâ</div>
                <div class="text-sm font-medium">Event/Party</div>
              </div>
            </label>
            <label class="relative">
              <input type="radio" name="event_type" value="wedding" class="peer sr-only" />
              <div class="p-4 border-2 border-gray-200 rounded-xl text-center cursor-pointer peer-checked:border-primary-500 peer-checked:bg-primary-50 hover:border-gray-300 transition-colors">
                <div class="text-2xl mb-1">üíí</div>
                <div class="text-sm font-medium">Wedding</div>
              </div>
            </label>
            <label class="relative">
              <input type="radio" name="event_type" value="construction" class="peer sr-only" />
              <div class="p-4 border-2 border-gray-200 rounded-xl text-center cursor-pointer peer-checked:border-primary-500 peer-checked:bg-primary-50 hover:border-gray-300 transition-colors">
                <div class="text-2xl mb-1">üèóÔ∏è</div>
                <div class="text-sm font-medium">Construction</div>
              </div>
            </label>
            <label class="relative">
              <input type="radio" name="event_type" value="festival" class="peer sr-only" />
              <div class="p-4 border-2 border-gray-200 rounded-xl text-center cursor-pointer peer-checked:border-primary-500 peer-checked:bg-primary-50 hover:border-gray-300 transition-colors">
                <div class="text-2xl mb-1">üé™</div>
                <div class="text-sm font-medium">Festival</div>
              </div>
            </label>
          </div>
        </div>

        <!-- Number of People -->
        <div>
          <label for="guests" class="block text-sm font-semibold text-gray-700 mb-2">
            How many people?
          </label>
          <input
            type="number"
            id="guests"
            name="guests"
            min="1"
            max="100000"
            value="100"
            required
            class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-lg"
          />
        </div>

        <!-- Duration -->
        <div>
          <label for="duration" class="block text-sm font-semibold text-gray-700 mb-2">
            Duration (hours)
          </label>
          <select
            id="duration"
            name="duration"
            class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-lg"
          >
            <option value="2">2 hours</option>
            <option value="4" selected>4 hours</option>
            <option value="6">6 hours</option>
            <option value="8">8 hours (full day)</option>
            <option value="12">12+ hours</option>
          </select>
        </div>

        <!-- Options -->
        <div class="space-y-3">
          <label class="flex items-center">
            <input type="checkbox" id="alcohol" name="alcohol" class="w-5 h-5 rounded border-gray-300 text-primary-600 focus:ring-primary-500" />
            <span class="ml-3 text-gray-700">Alcohol will be served</span>
            <span class="ml-2 text-xs text-gray-500">(+20% more units)</span>
          </label>
          <label class="flex items-center">
            <input type="checkbox" id="ada" name="ada" class="w-5 h-5 rounded border-gray-300 text-primary-600 focus:ring-primary-500" checked />
            <span class="ml-3 text-gray-700">Include ADA accessible unit</span>
          </label>
          <label class="flex items-center">
            <input type="checkbox" id="handwash" name="handwash" class="w-5 h-5 rounded border-gray-300 text-primary-600 focus:ring-primary-500" checked />
            <span class="ml-3 text-gray-700">Include hand wash stations</span>
          </label>
        </div>

        <button
          type="submit"
          class="w-full bg-primary-600 text-white py-4 px-6 rounded-xl font-semibold text-lg hover:bg-primary-700 transition-colors"
        >
          Calculate My Needs
        </button>
      </form>
    </div>

    <!-- Results (hidden by default) -->
    <div id="results" class="hidden">
      <div class="bg-gradient-to-br from-primary-600 to-blue-700 rounded-2xl shadow-xl p-6 md:p-8 text-white mb-8">
        <h2 class="text-2xl font-bold mb-6 text-center">Your Recommendation</h2>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
          <div class="bg-white/10 backdrop-blur rounded-xl p-5 text-center">
            <div id="result-standard" class="text-4xl font-bold mb-1">0</div>
            <div class="text-blue-100">Standard Units</div>
          </div>
          <div class="bg-white/10 backdrop-blur rounded-xl p-5 text-center">
            <div id="result-ada" class="text-4xl font-bold mb-1">0</div>
            <div class="text-blue-100">ADA Accessible</div>
          </div>
          <div class="bg-white/10 backdrop-blur rounded-xl p-5 text-center">
            <div id="result-handwash" class="text-4xl font-bold mb-1">0</div>
            <div class="text-blue-100">Hand Wash Stations</div>
          </div>
        </div>

        <div id="result-notes" class="bg-white/10 backdrop-blur rounded-xl p-4 text-sm text-blue-100">
        </div>
      </div>

      <!-- Estimated Cost -->
      <div class="bg-white rounded-2xl shadow-xl p-6 md:p-8 mb-8">
        <h3 class="text-xl font-bold text-gray-900 mb-4">Estimated Cost Range</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="border border-gray-200 rounded-xl p-5">
            <div class="text-sm text-gray-500 mb-1">Daily Rental</div>
            <div id="cost-daily" class="text-2xl font-bold text-gray-900">$0 - $0</div>
          </div>
          <div class="border border-gray-200 rounded-xl p-5">
            <div class="text-sm text-gray-500 mb-1">Weekly Rental</div>
            <div id="cost-weekly" class="text-2xl font-bold text-gray-900">$0 - $0</div>
          </div>
        </div>
        <p class="text-sm text-gray-500 mt-4">
          * Prices vary by location, provider, and season. Contact local providers for exact quotes.
        </p>
      </div>

      <!-- CTA -->
      <div class="bg-gray-50 rounded-2xl p-6 md:p-8 text-center">
        <h3 class="text-xl font-bold text-gray-900 mb-2">Ready to Rent?</h3>
        <p class="text-gray-600 mb-6">Find porta potty providers in your area and get quotes.</p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a href="/states" class="inline-flex items-center justify-center bg-primary-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-primary-700 transition-colors">
            Browse Providers
          </a>
          <a href="/search" class="inline-flex items-center justify-center border border-gray-300 bg-white text-gray-700 px-6 py-3 rounded-lg font-medium hover:bg-gray-50 transition-colors">
            Search by Location
          </a>
        </div>
      </div>
    </div>

    <!-- Info Section -->
    <div class="mt-12 prose prose-lg max-w-none">
      <h2>How Many Porta Potties Do I Need?</h2>
      <p>
        The number of portable toilets you need depends on several factors: the number of guests,
        event duration, and whether alcohol is being served. Here are the industry-standard guidelines:
      </p>

      <h3>General Rules</h3>
      <ul>
        <li><strong>1 unit per 50 guests</strong> for events up to 4 hours</li>
        <li><strong>1 unit per 35 guests</strong> for events 4-8 hours</li>
        <li><strong>Add 20% more units</strong> if alcohol is served</li>
        <li><strong>1 ADA unit</strong> for every 20 standard units (minimum 1 for public events)</li>
        <li><strong>1 hand wash station</strong> for every 4 porta potties</li>
      </ul>

      <h3>Construction Sites (OSHA Requirements)</h3>
      <p>
        OSHA requires employers to provide toilet facilities for employees. The general requirement is:
      </p>
      <ul>
        <li>1-20 workers: 1 toilet</li>
        <li>20-35 workers: 2 toilets</li>
        <li>35-55 workers: 3 toilets</li>
        <li>55-80 workers: 4 toilets</li>
        <li>80-110 workers: 5 toilets</li>
        <li>110-150 workers: 6 toilets</li>
      </ul>

      <h3>Pro Tips</h3>
      <ul>
        <li>Book 2-3 weeks in advance, especially for peak season (spring/summer)</li>
        <li>Consider luxury trailers for weddings and upscale events</li>
        <li>Place units on flat, accessible ground for delivery trucks</li>
        <li>Weekly servicing is standard; request more frequent service for multi-day events</li>
      </ul>
    </div>
  </div>
</BaseLayout>

<script>
  const form = document.getElementById('calculator-form') as HTMLFormElement;
  const resultsDiv = document.getElementById('results') as HTMLDivElement;

  form?.addEventListener('submit', (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const eventType = formData.get('event_type') as string;
    const guests = parseInt(formData.get('guests') as string) || 100;
    const duration = parseInt(formData.get('duration') as string) || 4;
    const hasAlcohol = formData.get('alcohol') === 'on';
    const needsAda = formData.get('ada') === 'on';
    const needsHandwash = formData.get('handwash') === 'on';

    let unitsPerGuest: number;
    let notes: string[] = [];

    // Calculate base units based on event type and duration
    if (eventType === 'construction') {
      // OSHA guidelines for construction
      if (guests <= 20) unitsPerGuest = 1 / guests;
      else if (guests <= 35) unitsPerGuest = 2 / guests;
      else if (guests <= 55) unitsPerGuest = 3 / guests;
      else if (guests <= 80) unitsPerGuest = 4 / guests;
      else if (guests <= 110) unitsPerGuest = 5 / guests;
      else unitsPerGuest = 6 / guests + (guests - 150) / 40 / guests;

      notes.push('Based on OSHA construction site requirements');
    } else {
      // Event-based calculation
      if (duration <= 4) {
        unitsPerGuest = 1 / 50;
      } else if (duration <= 8) {
        unitsPerGuest = 1 / 35;
      } else {
        unitsPerGuest = 1 / 25;
      }

      if (eventType === 'festival') {
        unitsPerGuest *= 1.25; // Festivals need more
        notes.push('Festival events typically need 25% more units due to higher usage');
      }

      if (eventType === 'wedding') {
        notes.push('Consider luxury restroom trailers for a more upscale experience');
      }
    }

    let standardUnits = Math.ceil(guests * unitsPerGuest);

    // Alcohol adjustment
    if (hasAlcohol && eventType !== 'construction') {
      standardUnits = Math.ceil(standardUnits * 1.2);
      notes.push('Added 20% for alcohol service');
    }

    // Minimum 1 unit
    standardUnits = Math.max(1, standardUnits);

    // ADA units (1 per 20 standard, minimum 1)
    let adaUnits = 0;
    if (needsAda) {
      adaUnits = Math.max(1, Math.ceil(standardUnits / 20));
    }

    // Hand wash stations (1 per 4 units)
    let handwashUnits = 0;
    if (needsHandwash) {
      handwashUnits = Math.max(1, Math.ceil(standardUnits / 4));
    }

    // Cost estimates (rough ranges)
    const standardDailyCost = { low: 75, high: 150 };
    const adaDailyCost = { low: 150, high: 250 };
    const handwashDailyCost = { low: 50, high: 100 };

    const dailyLow = (standardUnits * standardDailyCost.low) + (adaUnits * adaDailyCost.low) + (handwashUnits * handwashDailyCost.low);
    const dailyHigh = (standardUnits * standardDailyCost.high) + (adaUnits * adaDailyCost.high) + (handwashUnits * handwashDailyCost.high);
    const weeklyLow = Math.round(dailyLow * 5);
    const weeklyHigh = Math.round(dailyHigh * 5);

    // Update results
    document.getElementById('result-standard')!.textContent = standardUnits.toString();
    document.getElementById('result-ada')!.textContent = adaUnits.toString();
    document.getElementById('result-handwash')!.textContent = handwashUnits.toString();
    document.getElementById('result-notes')!.innerHTML = notes.length > 0
      ? '<strong>Notes:</strong> ' + notes.join(' ‚Ä¢ ')
      : 'Based on industry standard calculations.';
    document.getElementById('cost-daily')!.textContent = `$${dailyLow.toLocaleString()} - $${dailyHigh.toLocaleString()}`;
    document.getElementById('cost-weekly')!.textContent = `$${weeklyLow.toLocaleString()} - $${weeklyHigh.toLocaleString()}`;

    // Show results
    resultsDiv.classList.remove('hidden');
    resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
  });
</script>
